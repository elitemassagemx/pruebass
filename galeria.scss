// Variables
$gallery-size: 6;
$gallery-gap: 0.5em;
$lightbox-background: rgba(black, 0.5);
$transition-duration: 450ms;
$mobile-breakpoint: 800px;
$small-mobile-breakpoint: 350px;

// Mixins
@mixin flex-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

@mixin transition($property: all) {
  transition: $property $transition-duration ease-in-out;
}

// Reset
* {
  box-sizing: border-box;
}

body {
  margin: 5px;
  position: relative;
}

// Gallery
#gallery {
  display: grid;
  height: calc(100vh - 10px);
  grid-template: repeat($gallery-size, 1fr) / repeat($gallery-size, 1fr);
  grid-gap: $gallery-gap;

  @media (max-width: $mobile-breakpoint) {
    @include flex-center;
    flex-wrap: wrap;
    align-items: flex-start;
  }

  // Gallery items
  & > div {
    @include positionAndShadow;
    
    @media (max-width: $mobile-breakpoint) {
      width: 48%;
      margin: 1%;

      @media (max-width: $small-mobile-breakpoint) {
        width: 98%;
      }
    }

    // Grid structure
    @include gridStructure;

    // Hover effects
    @include hoverEffects;
  }

  // Common styles for div and a
  div,
  a {
    @include flex-center;
    text-decoration: none;
  }
}

// Lightbox
[id^="lightbox-"] {
  @include lightboxBase;
  
  &:target {
    @include lightboxTarget;
  }

  .content {
    @include lightboxContent;
  }

  .title {
    @include lightboxTitle;
  }

  img {
    @include lightboxImage;
  }

  a.close {
    @include closeButton;
  }
}

// Mixins for gallery items
@mixin positionAndShadow {
  overflow: hidden;
  position: relative;
  box-shadow: 0 2px 8px 0 rgba(#000, 0.2), 0 3px 20px 0 rgba(#000, 0.19);
}

@mixin gridStructure {
  &:nth-child(#{$gallery-size}n + 1) {
    grid-column: span 2;
    grid-row: span 2;
  }
  &:nth-child(2) {
    grid-column: span 3;
    grid-row: span 3;
  }
  &:nth-child(4) {
    grid-column: span 1;
    grid-row: span 2;
  }
}

@mixin hoverEffects {
  & > a {
    @include overlayText;
  }

  & > img {
    width: 100%;
    min-height: 100%;
    @include transition;
  }

  &:hover {
    img {
      filter: blur(4px);
    }
    a {
      opacity: 1;
    }
  }
}

@mixin overlayText {
  opacity: 0;
  position: absolute;
  color: #000;
  background-color: #000;
  font: bold 4em "Helvetica";
  padding: 2rem;
  mix-blend-mode: difference;
  width: 100%;
  height: 100%;
  @include transition;

  $shadow: 5px #fff;
  text-shadow: 
    0 -1px $shadow,
    -1px 0px $shadow,
    0 1px $shadow,
    1px 0px $shadow;
}

// Mixins for lightbox
@mixin lightboxBase {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: $lightbox-background;
  @include flex-center;
  opacity: 0;
  @include transition(opacity);
  pointer-events: none;
}

@mixin lightboxTarget {
  opacity: 1;
  pointer-events: inherit;
  img {
    filter: blur(0);
  }
}

@mixin lightboxContent {
  max-width: 90%;
  position: relative;
  color: #fff;

  &:hover {
    > a.close {
      opacity: 1;
      transform: scale(1, 1);
    }
    > .title {
      opacity: 1;
      transform: translateY(-3px);
      &::after {
        opacity: 1;
      }
    }
  }

  & > * {
    @include transition;
  }
}

@mixin lightboxTitle {
  display: block;
  margin: 0;
  padding: 1em;
  position: absolute;
  bottom: 0;
  width: 100%;
  transform: translateY(50%);
  font-size: 1.5em;
  opacity: 0;

  &::after {
    content: ' ';
    background-color: rgba(black, 0.4);
    bottom: 0;
    left: 0;
    height: 100%;
    width: 100%;
    position: absolute;
    @include transition;
    opacity: 0;
    transform-origin: bottom;
    mix-blend-mode: soft-light;
  }
}

@mixin lightboxImage {
  max-height: 90vh;
  max-width: 100%;
  margin: 0;
  padding: 0;
  filter: blur(50px);
}

@mixin closeButton {
  width: 2em;
  height: 2em;
  position: absolute;
  right: 0;
  top: 0;
  background-color: rgba(black, 0.5);
  @include flex-center;
  transform: scale(0, 0);
  opacity: 0;
  transform-origin: right top;
  text-decoration: none;
  color: #fff;

  &::after {
    content: "X";
  }
}
